<div class="container py-4">

  <!-- Top Navigation -->
  

  <!-- Loading Spinner -->
  <div *ngIf="isLoading" class="text-center py-5">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
  </div>

  <!-- Outer: check loading -->
<ng-container *ngIf="!isLoading; else loading">
  
  <!-- Inner: check if user is logged in -->
  <ng-container *ngIf="user$ | async as user; else publicView">
    <div [@slideInOut]>
      <!-- Dashboard for logged-in user -->
      <div class="row g-4">
        <div class="col-md-4">
          <div class="dashboard-card shadow-sm h-100 text-center p-4 rounded-4"
              style="background: linear-gradient(135deg, #e0f7fa 0%, #b2ebf2 100%); transition: transform 0.3s;">
            <i class="bi bi-clipboard-check display-4 text-success mb-3"></i>
            <h5 class="fw-bold mb-2">Today's Routine</h5>

            <ng-container *ngIf="todayRoutine; else noRoutine">
              <h6 class="mt-3 fw-semibold">{{ todayRoutine.name }}</h6>
              <p class="text-muted small">
                {{ todayRoutine.exercises.length }} exercises · {{ todayRoutine.time }}
              </p>
              <a routerLink="/routines/{{ todayRoutine.id }}" class="btn btn-success btn-sm mt-2">
                View Routine
              </a>
            </ng-container>
            <ng-template #noRoutine>
              <p class="text-muted small">No routine scheduled for today.</p>
              <a routerLink="/routines" class="btn btn-outline-success btn-sm mt-2">
                Browse Routines
              </a>
            </ng-template>
          </div>
        </div>

        <!-- Current Streak -->
        <div class="col-md-4">
          <div class="dashboard-card shadow-sm h-100 text-center p-4 rounded-4 align-items-center d-flex flex-column"
              style="background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%); transition: transform 0.3s;">
            <i class="bi bi-fire display-4 text-danger mb-3"></i>
            <h5 class="fw-bold mb-2">Current Streak</h5>

            <ng-container *ngIf="currentStreak > 0; else noStreak">
              <div class="streak-card shadow-sm" *ngIf="todayRoutine">
                <p class="display-5 fw-bold text-danger mt-3">{{ currentStreak }}</p>
                <p class="text-muted small">days in a row</p>
                <p class="text-muted small">Keep it going!</p>
              </div>
              
            </ng-container>

            <ng-template #noStreak>
              <p class="text-muted small">No streak yet. Start today!</p>
              <a routerLink="/routines" class="btn btn-outline-danger btn-sm mt-2">Start Routine</a>
            </ng-template>
          </div>
        </div>

        <!-- Daily Challenge -->
        <div class="col-md-4">
          <div class="dashboard-card shadow-sm h-100 text-center p-4 rounded-4 align-items-center d-flex flex-column"
              style="background: linear-gradient(135deg, #fffde7 0%, #fff9c4 100%); transition: transform 0.3s;">
            <i class="bi bi-trophy display-4 text-warning mb-3"></i>
            <h5 class="fw-bold mb-2">Daily Challenge</h5>

            <ng-container *ngIf="dailyChallenge; else noChallenge">
              <h6 class="mt-3">{{ dailyChallenge.title }}</h6>
              <p class="text-muted small">{{ dailyChallenge.description }}</p>
              <a routerLink="/challenges" class="btn btn-warning btn-sm mt-2">
                Take Challenge
              </a>
            </ng-container>

            <ng-template #noChallenge>
              <p class="text-muted small">No challenge today. Check back tomorrow!</p>
              <a routerLink="/challenges" class="btn btn-outline-warning btn-sm mt-2">
                Browse Challenges
              </a>
            </ng-template>
          </div>
        </div>
      </div>
    </div>
  </ng-container>

</ng-container>

<ng-template #loading>
  <div class="text-center py-5">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
  </div>
</ng-template>
  </div>

  <!-- Public View -->
  <ng-template #publicView>
    <div class="my-5" [@slideInOut]>
      <div class="p-5 shadow text-center text-white rounded-4"
           style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
        <div class="mb-4">
          <i class="bi bi-activity display-3"></i>
        </div>
        <h2 class="fw-bold mb-3 display-5">Level Up Your Fitness Journey</h2>
        <p class="fs-4 mb-3">
          Track workouts, build streaks, and stay motivated with a community that moves with you.
        </p>
        <p class="small opacity-85 mb-4 fs-6">Stronger every day — start where you are.</p>

        <a id="firstStartBtn" routerLink="/login" class="btn btn-light btn-lg px-5 py-2 rounded-pill fw-semibold fs-5 shadow-sm start-btn">
          Get Started
        </a>
      </div>
    </div>

    <!-- Features Section -->
  <section class="container my-5 text-center">
    <h3 class="fw-bold mb-4">What You Can Do</h3>
    <div class="row g-4">
      <div class="col-md-4">
        <div class="p-4 rounded-3 shadow-sm bg-white h-100">
          <i class="bi bi-clipboard-check display-5 text-success mb-3"></i>
          <h5 class="fw-bold">Log Your Workouts</h5>
          <p class="text-muted">Track your daily exercises, reps, sets, and progress effortlessly.</p>
        </div>
      </div>

      <div class="col-md-4">
        <div class="p-4 rounded-3 shadow-sm bg-white h-100">
          <i class="bi bi-fire display-5 text-danger mb-3"></i>
          <h5 class="fw-bold">Maintain Your Streak</h5>
          <p class="text-muted">Stay consistent and earn streak milestones for your dedication.</p>
        </div>
      </div>

      <div class="col-md-4">
        <div class="p-4 rounded-3 shadow-sm bg-white h-100">
          <i class="bi bi-trophy display-5 text-warning mb-3"></i>
          <h5 class="fw-bold">Join Challenges</h5>
          <p class="text-muted">Compete with the community and push yourself to new heights.</p>
        </div>
      </div>
    </div>
  </section>

  <!-- App Preview Section -->
  <section class="container my-5">
    <div class="row align-items-center g-4">
      <div class="col-md-6">
        <h3 class="fw-bold mb-3">Your Progress at a Glance</h3>
        <p class="text-muted">
          A clean and user-friendly dashboard lets you easily view routines, achievements, streaks,
          and your overall fitness journey.
        </p>
        <p class="text-muted">
          Built to motivate you every day.
        </p>
      </div>

      <div class="col-md-6 text-center">
        <div class="bg-light rounded-4 shadow p-4">
          <img src="https://images.unsplash.com/photo-1551288049-bebda4e38f71?q=80"
               alt="Fitness Progress"
               class="img-fluid rounded-3">
        </div>
      </div>
    </div>
  </section>

  <!-- Testimonials Section -->
  <section class="container my-5">
    <h3 class="text-center fw-bold mb-4">What People Are Saying</h3>
    <div class="row g-4">
      <div class="col-md-4" *ngFor="let t of testimonials">
        <div class="p-4 bg-white rounded-3 shadow-sm h-100">
          <p class="fst-italic">“{{ t.text }}”</p>
          <p class="fw-bold mb-0">— {{ t.name }}, {{ t.age }}</p>
        </div>
      </div>
    </div>
  </section>

  <!-- Final CTA -->
  <section class="py-5 text-center text-white mt-5 rounded-4"
           style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
    <h3 class="fw-bold mb-3">Ready to Start Your Journey?</h3>
    <p class="mb-4">The best time to move is now. Take the first step toward a healthier you.</p>
    <a class="btn btn-light btn-lg px-5 py-2 rounded-pill fw-semibold"
     (click)="scrollToFirstButton()">
    Get Started
  </a>
</section>
</ng-template>
